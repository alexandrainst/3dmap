<html>
	<head>
		<title>My first Three.js app</title>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
		</style>
		
		<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
		<script src="js/three.min.js"></script>
		<script src="js/utm-converter/src/converter.js"></script>
	</head>
	<body>
		<script>
		    var threeObjects=[];
		    var renderer=null;
		    var scene=null;
		    var camera=null;
		    
		    populateMap();
		
		    function setup(){
		        scene = new THREE.Scene();
                camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 0.1, 100000 );

                renderer = new THREE.WebGLRenderer();
                renderer.setSize( window.innerWidth, window.innerHeight );
                renderer.setClearColor(0xdddddd);
                document.body.appendChild( renderer.domElement );
            
                var geometry = new THREE.BoxGeometry( 1, 1, 1 );
                var material = new THREE.MeshLambertMaterial( {color: 0x00ff00} );
                var cube = new THREE.Mesh( geometry, material );
                cube.position.x=threeObjects[0].geometry.vertices[0].x;
                cube.position.y=threeObjects[0].geometry.vertices[0].y;
                cube.position.z=0;
                scene.add( cube );

                camera.position.z = 50;
                camera.position.x = threeObjects[0].geometry.vertices[0].x-800;
                camera.position.y =threeObjects[0].geometry.vertices[0].y;
                //camera.lookAt( scene.position );
                camera.lookAt(cube.position);
            
            
                // add spotlight for the shadows
                /*var spotLight = new THREE.SpotLight(0xffffff);
                spotLight.position.set(-10, 60, 60);
                spotLight.castShadow = true;
                scene.add(spotLight);*/
            
                hemiLight = new THREE.HemisphereLight( 0xffffff, 0xffffff, 0.6 );
                hemiLight.color.setHSL( 0.6, 1, 0.6 );
                hemiLight.groundColor.setHSL( 0.095, 1, 0.75 );
                hemiLight.position.set( 0, 500, 0 );
                scene.add( hemiLight );
                
                $.each(threeObjects, function(i, item){
                    scene.add(item);
                });
                
                render();
            
                /*var planeGeo = new THREE.PlaneGeometry(300,300);
                var planeMat = new THREE.MeshLambertMaterial({color: 0x666699});
                var plane = new THREE.Mesh(planeGeo, planeMat);
 
                // rotate it to correct position
                plane.rotation.x = -Math.PI/2;
                scene.add(plane);*/
		    }
            

			var render = function () {
				requestAnimationFrame( render );

                /*for ( var i = 0, l = geometry.vertices.length; i < l; i ++ ) {
					geometry.vertices[ i ].y = 35 * Math.sin( i / 5 + ( time + i ) / 7 );
				}*/

               /* cube.scale.y +=0.003;
                cube.material.color.r +=0.001;
                cube.material.color.g +=0.003;
                cube.material.color.b +=0.01;*/
                
				//cube.rotation.x += 0.1;
				//cube.rotation.y += 0.1;

				renderer.render(scene, camera);
			};
			
			
			/*****************************/
			/*                           */
			/*         Geo data          */	
			/*                           */
			/*****************************/
			
			// get the data
			function populateMap(){
                jQuery.getJSON('data/testdata.json', function(data) {
                    var converter = new UtmConverter();
                    
                    $.each(data.features,function(i, item){
                        var rectShape = new THREE.Shape();
                        var height=0;
                        
                        $.each(item.geometry.coordinates, function(j, itemTwo){
                            var utmResult= converter.toUtm({coord: [itemTwo[0], itemTwo[1]]});
                            if (j==0){
                                height=itemTwo[2];
                                rectShape.moveTo(utmResult.coord.x, utmResult.coord.y);
                            }else{
                                rectShape.lineTo(utmResult.coord.x, utmResult.coord.y);
                            }
                        });

                        var geometry = new THREE.ExtrudeGeometry(rectShape, { amount: height, bevelEnabled: true, bevelSegments: 1, steps: 1, bevelSize: 0.1, bevelThickness: 0.1 });
                        var material = new THREE.MeshLambertMaterial({color: 0x777777});
                        var rectMesh = new THREE.Mesh(geometry, material) ;		
                        //rectMesh.rotation.x = -Math.PI/2;
                        //console.log(rectMesh);

                        threeObjects.push(rectMesh);
                    });
                    
                    setup();
                    
                });
            }
					
		</script>
	</body>
</html>